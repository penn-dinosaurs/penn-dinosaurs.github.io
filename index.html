<!DOCTYPE html>
<<<<<<< HEAD
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>ESE 5190 Final Project</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<!--    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap.bundle.min.js"></script>
-->
  </head>
  <body>
      <div class="container-fluid">
        <!--<div class="topNav">
          <ul class="topNavContent">
            <li>Brahmapur, India</li>
            <li>pdebasish624@gmail.com</li>
            <li>333333333</li>
          </ul>
        </div>-->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <a class="navbar-brand" href="#" style=" color: rgba(22,116,24,0.7); font-weight:bold; ">Penn Dinosaurs</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" name="button" data-target="#myNavbar">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav ml-auto">
              <li><a class="nav-link" href="https://github.com/penn-dinosaurs/ESE-519-FINAL-PROJECT-Penn-Dinosaurs">Project</a></li>
              <li><a class="nav-link" href="about.html">About Us</a></li>
              <li><a class="nav-link" href="contact.html">Contact Us</a></li>
            </ul>
            </div>
        </nav>
        <div class="bottomNav"></div>
        </div>
        <div class="container">
          <div class="row row1">
            <img class="img-responsive lead" src="img/dino.jpg" alt="Introduction"/>
            <div class="myInfo">
              <center>
                <h1 style="color:rgb(34, 139, 34);">Hello, We are Team Penn Dinosaurs!</h1>
                <h6 class="lead" style="margin-top:25px; padding:5px">
                  Here, You can take a tour of our project named <mark>"Customer-experience enhancement system!"</mark> <br> that we developed while working on final project for ESE 5190 course.
                </h6>
              <!--  <a href="#about"><button class="btn btn-lg" type="button" name="button">Explore</button></a>-->
              </center>
            </div>
          </div>

          <div class="container">
          <!--Row2-->
          <div class="row row2" id="about">
              <h3>University of Pennsylvania, ESE 5190: Intro to Embedded Systems - Final Project</h3>
              <pre style="margin-top: 30px;">
                SATYAJEET DAS
                    LinkedIn: https://www.linkedin.com/in/satyajeet-das/
                Soumya Dash
                    LinkedIn: https://www.linkedin.com/in/srd00/
                Qiao Xu
                    LinkedIn: https://www.linkedin.com/in/qiao-xu-b520a3249/

                Tested on:DELL Inspiron 16 Plus (16-inch, 2022), Windows 11 Home 21H2
                </pre>
          </div>
            <div class="row3" id="research">
              <h3>Introduction</h3><br>

              <p class="lead">
                The inconvenience of taking care of the children has bothered the customers who go for service or business for a long time, and few ways are efficient enough to help the customer take care of the children. One possible option is to hire people for children-care services, which is expensive and may not be feasible for most general service institutions since they may not have much extra budget. Inspired by the idea of the chrome dino game, a design of the customer-experience enhancement system is proposed to provide a feasible and reliable way to take care of the children of customers when they come for service to improve customer experience further. The system combines the dino game, face tracking pan-tilt camera, and the LCD & Speaker arrangement for customer interaction for playing music.

                In the paper, we will introduce the project's background(problem statement) first, then discuss the source of inspiration. Next, we will illustrate the system architecture and objects of this system. After giving this basic information about the project, we will show the technical details, such as the component lists, the connection diagram, the troubleshooting process, and the result.
              </p>

                <ul>
                  <li class="nav-link">Protein engineering</li>
                  <li class="nav-link">Biomedical engineering</li>
                  <li class="nav-link">Biomaterials</li>
                  <li class="nav-link">Computational Biology</li>
                </ul>
            </div>

            <div class="row4" id="certifications">
              <h3>Problem Statement</h3><br>

              <p class="lead">
                The inconvenience of taking care of the children has bothered the customers who go for service or business for a long time, and few ways are efficient enough to help the customer take care of the children. One possible option is to hire people for children-care services, which is expensive and may not be feasible for most general service institutions since they may not have much extra budget. Inspired by the idea of the chrome dino game, a design of the customer-experience enhancement system is proposed to provide a feasible and reliable way to take care of the children of customers when they come for service to improve customer experience further. The system combines the dino game, face tracking pan-tilt camera, and the LCD & Speaker arrangement for customer interaction for playing music.

                In the paper, we will introduce the project's background(problem statement) first, then discuss the source of inspiration. Next, we will illustrate the system architecture and objects of this system. After giving this basic information about the project, we will show the technical details, such as the component lists, the connection diagram, the troubleshooting process, and the result.
              </p>
            </div>

            <div class="row5" id="publications">
              <h3>Inspiration of the project</h3><br>

              <p class="lead">
                The inconvenience of taking care of the children has bothered the customers who go for service or business for a long time, and few ways are efficient enough to help the customer take care of the children. One possible option is to hire people for children-care services, which is expensive and may not be feasible for most general service institutions since they may not have much extra budget. Inspired by the idea of the chrome dino game, a design of the customer-experience enhancement system is proposed to provide a feasible and reliable way to take care of the children of customers when they come for service to improve customer experience further. The system combines the dino game, face tracking pan-tilt camera, and the LCD & Speaker arrangement for customer interaction for playing music.

                In the paper, we will introduce the project's background(problem statement) first, then discuss the source of inspiration. Next, we will illustrate the system architecture and objects of this system. After giving this basic information about the project, we will show the technical details, such as the component lists, the connection diagram, the troubleshooting process, and the result.
              </p>
            </div>

            <div class="row5" id="architecture">
              <h3>Project Architecture</h3><br>
              <center>
              <img class="img-responsive" style="height:100%; width:100%; margin-top: 70px;"src="img/arch.png" alt="Introduction"/>
            </center>
            </div>

            <div class="row5" id="Circuit Diagram">
              <h3>Circuit Diagram of the elements of our Project</h3><br>
              <h4>Dino Game</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/dino_game_ckt.png" alt="Introduction"/>
              </center>

              <h4>Pan - Tilt Person Decting & Following Camera</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/pan_tilt_ckt.png" alt="Introduction"/>
              </center>

              <h4>Customer Interaction - LCD & Speaker for Playing</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/human_ckt.png" alt="Introduction"/>
              </center>
            </div>

            <div class="row5" id="Circuit Diagram">
              <h3>Operations/Functionalities:</h3><br>
              <h4>1. Dino Game:</h4><br>
              <p class = "lead">
                Our aim in this game was to develop Google's Dino game using the Raspberry Pi Pico board, which has an RP2040 microcontroller.
                <br><br>
                The following features are included in this game:
              </p>
              <ol type="1">
                    <li>
                      <p class="lead">
                        It has three levels (level1 - easy, Level 2 - Medium, Level 3 - Hard). The difficulty at each level would rise in proportion to the increasing score.
                      </p>
                    </li>
                    <li>
                      <p class="lead">
                        The game has two sounds, one for the humping dino and the other when the “Game is Over” (Dinosaur crashes with the cactus and dies), signifying that the user input of button press supplied by the Game player was successfully executed. Moreover, make the game more interactive. A speaker was employed for this reason.
                      </p>
                    </li>
                    <li>
                      <p class="lead">
                        It employs a VGA display to display all visuals on the monitor. We leveraged the PIO functionality of RP2040 to achieve this feat of running the VGA display using the tiny and cheap Pico. We used bitmaps to draw the shape of a dinosaur and different types of cacti.
                      </p>
                    </li>
                    <li>
                      <p class="lead">
                        For user interaction, we used a “glowing” big push button, for an interactive user experience.
                      </p>
                    </li>
                    <li>
                      <p class="lead">
                        We also created different high-score buffers for different levels. The aim was to keep track of the highest score achieved at each level. Moreover, to create a competition during the demo day to beat the highest score. This makes the game more user interactive and fun.
                      </p>
                    </li>
              </ol>

              <h4>2. Person Detection:</h4><br>
              <p class = "lead">
                This element of our project was utilized to recognize faces and shift the pan tilt to that direction dependent on the movement of the individual. This enables face tracking feature.
                <br><br>
                This work includes the following features:
              </p>
              <ol type="1">
                    <li>
                      <p class="lead">
                        It has three levels (level1 - easy, Level 2 - Medium, Level 3 - Hard). The difficulty at each level would rise in proportion to the increasing score.
                      </p>
                    </li>
                    <li>
                      <p class="lead">
                        It houses the Raspberry Pi Camera Module V2 on the Arducam Pan Tilt arrangement. This coordinated movement of servos and cameras enables the functionality of face tracking.
                      </p>
                    </li>
                    <li>
                      <p class="lead">
                        Its pan tilt camera would move up/down and left/right based on the person's movement measuring the relative movement of the frame and trying to reduce the positional error by moving the servos and hence the camera.
                      </p>
                    </li>
              </ol>

              <h4>3. Human Interaction Interface:</h4><br>
              <p class = "lead">
                This portion of our project was leveraged to construct a user interactive interface like "Google Assistant".
                <br><br>
                This work includes the following features:
              </p>
              <ol type="1">
                    <li>
                      <p class="lead">
                        It asks the person's name.
                      </p>
                    </li>
                    <li>
                      <p class="lead">
                        It greets the user by name, asks if they want to listen to music, and suggests some songs.
                      </p>
                    </li>
                    <li>
                      <p class="lead">
                        It plays the music based on various interest filters.
                      </p>
                    </li>
              </ol>

              <h6>Please find the detailed code and explaination here:</h6>
              <a href="https://github.com/satyajeetburla/ESE-519-FINAL-PROJECT/tree/main/code"><mark style="color:blue;">Project Code</mark></a>

            </div>

            <div class="row5" id="photos">
              <h3>Photos of our final model:</h3><br>
              <h4>Dino Game</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/dino_photo.jfif" alt="Introduction"/>
              </center>

              <h4>Pan - Tilt Person Decting & Following Camera</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/pan_tilt_photo.jpg" alt="Introduction"/>
              </center>

              <h4>Customer Interaction - LCD & Speaker for Playing</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/customer_photo.jfif" alt="Introduction"/>
              </center>
            </div>

            <div class="row5" id="photos">
              <h3>GIFs from our projects:</h3><br>
              <h4>Dino - Game: Level - 1</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/dino_level1.gif" alt="Introduction"/>
              </center>
              <h4>Dino - Game: Level - 2</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/dino_level2.gif" alt="Introduction"/>
              </center>
              <h4>Dino - Game: Level - 3</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/dino_level3.gif" alt="Introduction"/>
              </center>

              <h4>Pan - Tilt Person Decting & Following Camera</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/face_detection.gif" alt="Introduction"/>
              </center>

              <h4>Customer Interaction - LCD & Speaker for Playing</h4><br>
              <center>
                <img class="img-responsive" style="height:100%; width:80%; margin-top: 30px;"src="img/lcd_speaker.gif" alt="Introduction"/>
              </center>
            </div>

            <div class="row5" id="photos">
              <h3>Videos from our projects:</h3><br>
              <h4>Dino - Game: Level - 1</h4><br>
              <center>
                <video width="80%" height="500px" controls>
                  <source src="img/dino_level1.mp4" type="video/mp4" />
                </video>
              </center>
              <h4>Dino - Game: Level - 2</h4><br>
              <center>
                <video width="80%" height="500px" controls>
                  <source src="img/dino_level2.mp4" type="video/mp4" />
                </video>
              </center>
              <h4>Dino - Game: Level - 3</h4><br>
              <center>
                <video width="80%" height="500px" controls>
                  <source src="img/dino_level3.mp4" type="video/mp4" />
                </video>
              </center>

              <h4>Pan - Tilt Person Decting & Following Camera</h4><br>
              <center>
                <video width="80%" height="500px" controls>
                  <source src="img/face_detect.mp4" type="video/mp4" />
                </video>
              </center>

              <h4>Customer Interaction - LCD & Speaker for Playing</h4><br>
              <center>
                <video width="80%" height="500px" controls>
                  <source src="img/lcd_speaker.mp4" type="video/mp4" />
                </video>
              </center>
            </div>

            <center>
              <h1 style="font-family:monospace; color:red; margin-top:100px;">Thank You!</h2>
            </center>

          </div>
        </div>
      </div>

      <!--footer-->
      <div class="container-fluid">
        <footer>
          <center><p>Debasish Panda</p></center>
        </footer>
      </div>
=======
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>RP2040 Doom | rp2040-doom</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="RP2040 Doom" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Making of RP2040 Doom" />
<meta property="og:description" content="The Making of RP2040 Doom" />
<link rel="canonical" href="https://kilograham.github.io/rp2040-doom/" />
<meta property="og:url" content="https://kilograham.github.io/rp2040-doom/" />
<meta property="og:site_name" content="rp2040-doom" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="RP2040 Doom" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","description":"The Making of RP2040 Doom","headline":"RP2040 Doom","name":"rp2040-doom","url":"https://kilograham.github.io/rp2040-doom/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/rp2040-doom/assets/css/style.css?v=57f514373e39cc8bef751188e7ec7b4c051c01fd">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/rp2040-doom/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">RP2040 Doom</h1>
      <h2 class="project-tagline">The Making of RP2040 Doom</h2>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <p>This is part of the series behind the scenes of RP2040 Doom:</p>

<ul>
  <li>Introduction <strong>&lt;- this part</strong></li>
  <li><a href="/rp2040-doom/rendering.html">Rendering And Display Composition</a></li>
  <li><a href="/rp2040-doom/flash.html">Making It All Fit In Flash</a></li>
  <li><a href="/rp2040-doom/speed_and_ram.html">Making It Run Fast And Fit in RAM</a></li>
  <li><a href="/rp2040-doom/sound.html">Music And Sound</a></li>
  <li><a href="/rp2040-doom/networking.html">Network Games</a></li>
  <li><a href="/rp2040-doom/dev_overview.html">Development Overview</a></li>
</ul>

<p>See <a href="https://www.youtube.com/playlist?list=PL-_wCtHUfdDPi7i-4OIy5iQjQ3QSqq1Mh">here</a> for some nice videos of
RP2040 Doom in action. The code is <a href="https://github.com/kilograham/rp2040-doom">here</a>.</p>

<h1 id="the-challenge">The Challenge</h1>

<p><img src="/rp2040-doom/rp2040.jpg" alt="" /></p>

<p>Given a new platform it is only natural to think of porting Doom to it. With 264K of RAM, two CortexM0+ CPUs and a 
decent 
clock speed, the RP2040 is certainly not the tightest platform Doom has ever been ported to - although at &lt;$1 it 
is probably one of the cheapest - so I wanted to set my self a more aggressive set of goals:</p>

<ol>
  <li>
    <p>Everything should match the original game experience, i.e. all the graphics at classic 320x200 resolution, stereo 
sound effects, 
OPL2 music, save/load, demo playback, cheats, network multiplayer… basically it should feel like the original game.</p>
  </li>
  <li>
    <p>It should run on a Raspberry Pi Pico. This really tightens things up a lot, as there is only 2M of flash for all the 
code 
and data. Nevertheless, I decided that all 9 levels of the shareware <code class="language-plaintext highlighter-rouge">DOOM1.WAD</code> should be playable on the Pico in a 
single binary. There was to be no sneaky discarding of splash screens, altering of levels, down-sampling of 
textures or whatever. RP2040 boards with 8M should be able to play at least the full <em>Ultimate Doom</em> and <em>DOOM II</em> 
WADs.</p>
  </li>
  <li>
    <p>The RP2040 should output directly to VGA (16 color pins for RGB565 
along 
with HSync/VSync) along with stereo sound. Note that the RP2040 itself doesn’t have any video or audio hardware, 
however its PIO (Programmable IO) feature can be used to generate a wide range of digital signals under software 
control.</p>
  </li>
</ol>

<p>This all immediately presented some fairly obvious problems:</p>

<ol>
  <li>
    <p>The shareware <code class="language-plaintext highlighter-rouge">DOOM1.WAD</code> is 4M big, so it was going to need it to be decently compressed in order to end 
up significantly less than 2M, leaving enough space aside for the code/other data along with room for saved games 
too.</p>
  </li>
  <li>
    <p>VGA output means I would either need to draw the display “just ahead of the beam” at 60fps or to set aside a 
lot of the RAM for two 320 x 200 x 8-bit frame-buffers for double-buffering.</p>
  </li>
  <li>
    <p>If I took away RAM for the frame-buffers then I would be back with &lt;160K of RAM space which is really, really 
tight. This means I could not just decompress levels to RAM before they run. Equally, I could not hope to 
decompress 
levels to flash either since then there would be even less space for the code/WAD. This means the game would 
have to 
work 
directly 
off of compressed data in flash at runtime.</p>
  </li>
  <li>
    <p>Wanting to support the original demos means everything has to match <em>exactly</em> with the original game, as the 
demos are simply a sequence of input events, and the slightest calculation or behavior difference can cause 
<em>“desync”</em> 
ending up, for example, with the player running into, and shooting at, walls. I hit one such case, trying to save 
space by reflecting the quarter cycles of the <code class="language-plaintext highlighter-rouge">sin</code> table instead of storing all of them, and this caused desync 
even 
though the errors are at most 1/65536! On the bright side though, the demos turn out to be <em>really good</em> regression tests!</p>
  </li>
</ol>

<h1 id="the-results">The Results</h1>

<p>Here is a video of the Doom shareware version (<code class="language-plaintext highlighter-rouge">DOOM1.WAD</code>) running on a Raspberry Pi Pico with VGA and sound 
hooked up via fly-wires:</p>

<div style="position: relative; padding-bottom: 56.19%; clip-path: inset(2px 2px)">
<iframe style="border: 1; top: 0; left: 0; width: 100%; height: 100%; position: absolute;" src="https://www.youtube.com/embed/eDVazQVycP4" title="RP2040 Doom on a Raspberry 
Pi Pico" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>

<p>See <a href="https://www.youtube.com/playlist?list=PL-_wCtHUfdDPi7i-4OIy5iQjQ3QSqq1Mh">here</a> for more videos including some 
direct video/audio captures.</p>

<p>Features:</p>

<ul>
  <li>Full <code class="language-plaintext highlighter-rouge">DOOM1.WAD</code> playable on Raspberry Pi Pico with 2M flash.</li>
  <li><em>Ultimate Doom</em> and <em>Doom II</em> are playable on 8M devices.</li>
  <li>320x200x60 VGA output (really 1280x1024x60).</li>
  <li>9 Channel OPL2 Sound at 49716Hz.</li>
  <li>8 Channel Stereo Sound Effects.</li>
  <li>I2C networking for up to 4 players.</li>
  <li>Save/Load of games.</li>
  <li>All cheats supported.</li>
  <li>Demos from original WADs run correctly.</li>
  <li>USB Keyboard Input support.</li>
  <li>All end scenes, intermissions, help screens etc. supported.</li>
  <li>Good frame rate; generally 30-35+ FPS.</li>
  <li>Uses 270Mhz overclock (requires flash chip that will run at 135Mhz).</li>
</ul>

<p>The code can be found on <a href="https://github.com/kilograham/rp2040-doom">github</a>.</p>

<h1 id="rp2040-doom-development">RP2040 Doom Development</h1>

<p>Development happened, on and off, in bits of free time over about 6 months, with the rough process being:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>while (!convice_myself_its_probably_impossible()) {
    do_some_more();
}
</code></pre></div></div>

<p>At some points the next steps seemed motivation-zappingly hard, leading to a couple of hiatuses. 
That said, I wasn’t prepared to be beaten, so I kept coming back!</p>

<p>I had pretty good idea how I hoped things might work from the start, but there was an awful lot of 
everything to fit into flash, so there was always a chance it just wouldn’t happen.</p>

<p>Getting everything to work well was quite the adventure, so I figured others might be interested in a dip into how it 
works, problems I faced, and why I did some things the way I did. This is the point of this short “blog” series:</p>

<h1 id="section-overview">Section Overview</h1>

<p>This post is split into a number of distinct sections which are hopefully largely independent, so you can pick 
and choose the ones that interest you. In some cases a part may assume you have some knowledge from another part, 
but if so you can always go off and read that. The ordering of parts is somewhat arbitrary and based on my guess of 
what 
people might find most interesting/unique.</p>

<h2 id="rendering-and-display-composition">Rendering And Display Composition</h2>
<p>RP2040 Doom uses a very different rendering order compared to the original “vanilla” Doom, both to allow simultaneous 
rendering by 
both 
cores, but also to avoid decompressing the same source texture columns multiple times per frame.</p>

<p>Additionally, there is some hard work that goes 
into compositing the final display, dealing with menu overlays and wipe effects, all of which were complicated by the 
fact that there only turned out to be enough RAM for two 320x168 buffers, i.e. the area above the status bar. 
This section also describes how the 320x200 VGA display (actually 1280x1024) is driven.</p>

<p>You can read all about the rendering and display composition <a href="/rp2040-doom/rendering.html">here</a>.</p>

<h2 id="making-it-all-fit-in-flash">Making It All Fit In Flash</h2>
<p>As mentioned above, getting the whole shareware game to fit in 2M is hard work.  The level data, music and graphics 
are all compressed in novel/custom manners. All compressed level data and graphics must be random-accessible in flash,
as there 
is no 
spare RAM to compress even one level worth of anything.
All in all there are quite a number of interesting and perhaps unusual techniques used to shoe-horn the data into the 
new WHD (“<em>W</em>here’s <em>H</em>alf the <em>D</em>ata”) format, and they are described in this section.
Additionally, the saved game format had to be shrunk by a factor of about 10x to store saved games in flash too!</p>

<p>You can read all about the compression techniques <a href="/rp2040-doom/flash.html">here</a>.</p>

<h2 id="making-it-run-fast-and-fit-in-ram">Making It Run Fast And Fit in RAM</h2>

<p>The RP2040 only has 264K of RAM. A straight RP2040 compile of the Chocolate Doom source code off which RP2040 Doom is 
based requires 300K of static mutable data, and a minimum of about another 700K for dynamic allocation. The math 
clearly 
does 
not add up, so some liposuction would be required.</p>

<p>Additionally, there is little point in doing any of this if the game does not run at a decent frame rate. Getting 
things to run fast enough was also quite a challenge, and sadly the less RAM you have, the slower things are 
likely to be, as code or data are relegated to the slower-to-access flash.</p>

<p>You can read all about the techniques and trade-offs <a href="/rp2040-doom/speed_and_ram.html">here</a>.</p>

<h2 id="music-and-sound">Music And Sound</h2>

<p>One of the main sound cards of the day when Doom was the Sound Blaster which had 8-bit sampled audio output along 
with a 9 channel Yamaha YM3812 (OPL2) synthesizer as used on the prior Ad Lib card. Recreating this MIDI/synthesizer 
sound 
really duplicates the mood of the original game, but emulating the OPL2 fast enough to run on a Cortex-M0+ 
microcontroller at all is non-trivial. 
This is even more of a challenge if you want it to consume only a <em>small</em> 
fraction of your CPU time, and also use very little RAM.</p>

<p>This is discussed, along with brief details of the sampled sound effect generation, in the sound section <a href="/rp2040-doom/sound.html">here</a>.</p>

<h2 id="network-games">Network Games</h2>
<p>Microcontrollers have GPIOs, and you can connect them together with wires, so it seemed rude not to implement some 
sort of network game support. RP2040 Doom supports up to four players in regular/deathmatch mulit-player over a two 
wire I2C 
connection.</p>

<p>You can read brief details <a href="/rp2040-doom/networking.html">here</a>.</p>

<h2 id="development-overview">Development Overview</h2>

<p>I didn’t just start with a working source port and expect to compile it for the RP2040 and be immediately able to start 
debugging from there. This section describes the rough process of getting from A to B through intermediate steps, along 
with whatever other miscellaneous items that didn’t really fit anywhere else!</p>

<p>You can read more <a href="/rp2040-doom/dev_overview.html">here</a>.</p>

<h1 id="credits">Credits</h1>

<ul>
  <li>This port is based off the awesome original-dos-doom-experience-focused <a href="https://www.
chocolate-doom.org/wiki/index.
php/Chocolate_Doom">chocolate-doom</a>, 
which is itself based off the original Id Linux shareware <a href="https://github.com/id-Software/DOOM">source code</a>. Thanks of course to the original team at Id for starting it all.</li>
  <li>The OPL2 emulation is derived from <a href="https://github.com/digital-sound-antiques/emu8950">emu8950</a>.</li>
  <li>The sound effects are ADPCM compressed using <a href="https://github.com/dbry/adpcm-xq">ADPCM-XQ</a>.</li>
  <li>No code from other minimalist Doom ports is used, however I did borrow the classification of object types that 
are static decorations from a Doom-on-a-light-bulb port that came out just as I was about to have to do it myself!</li>
</ul>

<hr />

<p>Read the first section <a href="/rp2040-doom/rendering.html">Rendering And Display Composition</a> next.</p>

<p>Find me on <a href="https://twitter.com/kilograham5">twitter</a>.</p>


      <footer class="site-footer">
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
>>>>>>> 90c95c4ef17c560d750cea6dde63627cff40406d
  </body>
</html>
